## ðŸ§  Architektura â€“ opis ogÃ³lny

Backend skÅ‚ada siÄ™ z **4 warstw**:

### 1. Domain (DDD-light)
- Czysta domena biznesowa
- Encje / agregaty
- Value Objecty
- ReguÅ‚y biznesowe
- Interfejsy repozytoriÃ³w

âŒ Brak:
- Slim / HTTP
- ORM / SQL
- Storage / config

---

### 2. Application (Use-case layer)
- Przypadki uÅ¼ycia jako **Command / Query**
- **Handler** = wykonanie use-case
- **Validator** = walidacja wejÅ›cia
- **Policy** = autoryzacja / uprawnienia
- **Bus + middleware pipeline** (walidacja, transakcje, audit, cache)

To jest **mÃ³zg aplikacji**.

---

### 3. Infrastructure (adaptery)
- ORM + Postgres (implementacje repozytoriÃ³w)
- Storage (Cloudflare R2 / S3)
- Security (hash, tokeny)
- Config (env â†’ config)

Tu sÄ… **konkrety technologiczne**.

---

### 4. Delivery (transport)
- Slim Framework
- REST API (admin)
- GraphQL (public content â€“ Gatsby)
- Request / Resource jako osobne klasy

Delivery **mapuje wejÅ›cie i wyjÅ›cie**, nie robi biznesu.

---

## ðŸ” Pipeline (middleware)

### HTTP middleware (Slim)
- Auth
- Role / permissions
- CORS
- Rate limit
- JSON body
- Error handler

### Application middleware (Command / Query Bus)
- Validation
- Authorization
- Transaction
- Audit
- Cache (Query)

**PrzykÅ‚adowy flow:**
HTTP Request
- Request (mapowanie)
- CommandBus
- ValidationMiddleware
- AuthorizationMiddleware
- TransactionMiddleware
- Handler
- Resource (mapowanie)
- JSON Response

## ðŸŒ³ Drzewko katalogÃ³w
```
apps/
  api/
    src/
      Domain/
        Content/
          Entity/        # Page, Entry, Asset (agregaty/encje CMS)
          ValueObject/   # Slug, Locale, Status, ContentType, itp.
          Repository/    # interfejsy repo: PageRepository, AssetRepository
          Rule/          # reguÅ‚y domenowe (np. PublishRules)
          Exception/     # wyjÄ…tki domenowe (np. CannotPublishException)

        Auth/
          Entity/        # User (model domenowy)
          ValueObject/   # Role, Permission
          Policy/        # domenowe zasady dostÄ™pu (opcjonalnie)

        Shared/
          ValueObject/   # Id/Uuid, Email, DateRange (wspÃ³lne VO)
          Exception/     # wspÃ³lne wyjÄ…tki domenowe

      Application/
        Content/
          Command/       # CreatePageCommand, PublishPageCommand, UploadAssetCommand...
          Query/         # GetPageQuery, ListPagesQuery, SearchEntriesQuery...
          Handler/       # *Handler wykonuje Command/Query (use-case)
          Validator/     # waliduje Command/DTO (422)
          Policy/        # autoryzacja do use-case (RBAC, ownership)
          DTO/           # wej/wyj use-case (np. PageView, AssetView)

        Auth/
          Command/       # LoginCommand, LogoutCommand...
          Handler/
          Validator/
          DTO/

        Bus/
          Command/       # CommandBus (dispatch) + kontrakty
          Query/         # QueryBus (dispatch) + kontrakty

        Middleware/
          # application-level middleware dla busÃ³w:
          # ValidationMiddleware, AuthorizationMiddleware,
          # TransactionMiddleware, AuditMiddleware, CachingMiddleware(Query)

      Infrastructure/
        Persistence/
          # ORM + Postgres:
          # modele/rekordy ORM, migracje, implementacje repozytoriÃ³w

        Storage/
          # adapter R2 (S3-compatible):
          # presigned url, upload complete, metadane

        Security/
          # hasher haseÅ‚, generowanie/parsowanie tokenÃ³w, itp.

        Config/
          # adapter konfiguracji (env -> config), definicje ustawieÅ„

      Delivery/
        Http/
          Controller/
            Admin/       # REST admin controllers (bez biznesu)
            Public/      # np. /health, ewentualnie public endpoints

          Request/
            # per-endpoint request mappers:
            # CreatePageRequest, PublishPageRequest...
            # mapujÄ… PSR-7 -> Command/Query

          Resource/
            # per-entity / per-response presenters:
            # PageResource, AssetResource...
            # mapujÄ… DTO/Entity -> array JSON

          Middleware/
            # HTTP middleware:
            # Auth, Role, Cors, RateLimit, JsonBody, ErrorHandler

        GraphQL/
          Schema/        # definicje schematu
          Type/          # typy GraphQL
          Input/         # inputy (odpowiednik Request w GraphQL)
          Resolver/      # resolvery (mapujÄ… args -> Query/Handler)
          Resource/      # opcjonalne mapowanie wynikÃ³w do shape GraphQL
```


## ðŸ“Œ Konwencje (WAÅ»NE)
- **KaÅ¼dy endpoint REST**:
  - `Request` â†’ tworzy Command/Query
  - `Handler` â†’ wykonuje logikÄ™
  - `Resource` â†’ zwraca JSON
- **Delivery** nigdy nie dotyka ORM
- **Domain** nigdy nie widzi Slim / DB / Storage
- Cross-cutting concerns sÄ… **TYLKO w middleware**
- Use-case = **Command/Query + Handler**
- Architektura ma byÄ‡ **lekka, czytelna i powtarzalna**